{% extends "base.html" %}
{% load static %}

{% block title %}Visary | Financeiro{% endblock %}

{% block base_styles %}
    {{ block.super }}

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
    }

    .stats-card {
        background: var(--card-bg);
        border-radius: 24px;
        border: 1px solid var(--border-soft);
        box-shadow: 0 24px 48px rgba(5, 8, 17, 0.5);
        padding: 24px;
        text-align: center;
    }

    .stats-card span {
        display: block;
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 8px;
    }

    .stats-card strong {
        display: block;
        font-size: 2rem;
        color: var(--accent);
        font-weight: 700;
    }

    .actions-grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        margin-top: 32px;
    }

    .action-card {
        background: var(--card-bg);
        border-radius: 24px;
        border: 1px solid var(--border-soft);
        box-shadow: 0 24px 48px rgba(5, 8, 17, 0.5);
        padding: 32px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 16px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .action-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 32px 64px rgba(5, 8, 17, 0.6);
    }

    .action-card__icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--accent), var(--accent-strong));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #081423;
    }

    .action-card h3 {
        margin: 0;
        font-size: 1.3rem;
        color: var(--text-primary);
    }

    .action-card p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .action-card .btn {
        margin-top: auto;
    }

    .registros-list {
        margin-top: 32px;
    }

    .registros-list-card {
        background: var(--card-bg);
        border-radius: 24px;
        border: 1px solid var(--border-soft);
        box-shadow: 0 24px 48px rgba(5, 8, 17, 0.5);
        padding: 24px;
    }

    .registros-list-card header {
        margin-bottom: 20px;
    }

    .registros-list-card h2 {
        margin: 0;
        font-size: 1.2rem;
        color: var(--text-primary);
    }

    .registros-list-card p {
        margin: 8px 0 0 0;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .empty-state {
        padding: 18px;
        border-radius: 16px;
        border: 1px dashed rgba(86, 244, 156, 0.35);
        color: rgba(245, 245, 245, 0.72);
        text-align: center;
    }

    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .badge {
        display: inline-block;
        padding: 2px 10px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
        white-space: nowrap;
    }

    .badge-principal {
        background: rgba(86, 244, 156, 0.18);
        color: rgba(86, 244, 156, 0.95);
        border: 1px solid rgba(86, 244, 156, 0.4);
    }

    .badge-dependente {
        background: rgba(255, 193, 7, 0.18);
        color: rgba(255, 193, 7, 0.95);
        border: 1px solid rgba(255, 193, 7, 0.4);
    }

    .nome-cell {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .nome-cell__name {
        font-weight: 500;
        color: rgba(245, 245, 245, 0.92);
        line-height: 1.3;
    }

    .nome-cell__sub {
        font-size: 0.75rem;
        color: rgba(245, 245, 245, 0.5);
        line-height: 1.2;
    }

    .registro-item {
        padding: 12px;
        background: rgba(86, 244, 156, 0.08);
        border-radius: 12px;
        border: 1px solid rgba(86, 244, 156, 0.2);
    }

    .registro-item.row-dependente {
        border-left: 2px solid rgba(255, 193, 7, 0.25);
        padding-left: 20px;
    }

    .status-badge.pendente {
        background: rgba(255, 193, 7, 0.2);
        color: rgba(255, 193, 7, 0.95);
        border: 1px solid rgba(255, 193, 7, 0.4);
    }

    .status-badge.pago {
        background: rgba(86, 244, 156, 0.2);
        color: rgba(86, 244, 156, 0.95);
        border: 1px solid rgba(86, 244, 156, 0.4);
    }

    .status-badge.cancelado {
        background: rgba(244, 67, 54, 0.2);
        color: rgba(244, 67, 54, 0.95);
        border: 1px solid rgba(244, 67, 54, 0.4);
    }

    @media (max-width: 768px) {
        .actions-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .action-card {
            padding: 24px;
        }

        .stats-card {
            padding: 20px;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
{% endblock %}

{% block app_header %}
<section class="page-header">
    <div class="page-header__titles">
        <h1>Financeiro</h1>
        <p>Gerencie os registros financeiros das viagens.</p>
    </div>
</section>
{% endblock %}

{% block app_content %}
<section class="stats-grid">
    <div class="stats-card">
        <span>Total de Registros</span>
        <strong>{{ total_registros }}</strong>
    </div>
    <div class="stats-card">
        <span>Pendentes</span>
        <strong>{{ total_pendente }}</strong>
    </div>
    <div class="stats-card">
        <span>Pagamentos Recebidos</span>
        <strong>{{ total_pago }}</strong>
    </div>
    <div class="stats-card">
        <span>Valor Total</span>
        <strong>R$ {{ valor_total|floatformat:2 }}</strong>
    </div>
    <div class="stats-card">
        <span>Valor Pago</span>
        <strong>R$ {{ valor_pago|floatformat:2 }}</strong>
    </div>
    <div class="stats-card">
        <span>Valor Pendente</span>
        <strong>R$ {{ valor_pendente|floatformat:2 }}</strong>
    </div>
</section>

{% if ultimos_registros %}
<section class="registros-list">
    <article class="registros-list-card">
        <header>
            <h2>Ãšltimos Registros</h2>
            <p>Registros financeiros mais recentes</p>
        </header>
        <ul style="list-style: none; padding: 0; margin: 0; display: grid; gap: 12px;">
            {% for registro in ultimos_registros %}
                <li class="registro-item{% if registro.cliente and registro.cliente.is_dependente %} row-dependente{% endif %}">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                        <div>
                            {% if registro.cliente %}
                                <div class="nome-cell">
                                    <span class="nome-cell__name">{{ registro.cliente.nome }}</span>
                                    {% if registro.cliente.is_dependente %}
                                        <span class="badge badge-dependente">Dependente</span>
                                        {% if registro.cliente.cliente_principal %}
                                            <span class="nome-cell__sub">de {{ registro.cliente.cliente_principal.nome }}</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="badge badge-principal">Principal</span>
                                    {% endif %}
                                </div>
                            {% else %}
                                <strong style="color: var(--text-primary);">N/A</strong>
                            {% endif %}
                            <span style="color: var(--text-secondary); font-size: 0.85rem; margin-left: 8px;">
                                - {{ registro.assessor_responsavel.nome }}
                            </span>
                        </div>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <span style="color: var(--accent); font-size: 0.9rem; font-weight: 600;">
                                R$ {{ registro.valor|floatformat:2 }}
                            </span>
                            <span class="status-badge {{ registro.status }}">
                                {{ registro.get_status_display }}
                            </span>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </article>
</section>
{% endif %}

<section class="actions-grid">
    <article class="action-card">
        <div class="action-card__icon">ðŸ“‹</div>
        <h3>Listar Registros</h3>
        <p>Visualize todos os registros financeiros</p>
        <a href="{% url 'system:listar_financeiro' %}" class="btn btn-primary">Listar</a>
    </article>
</section>
{% endblock %}

