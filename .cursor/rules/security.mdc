---
description: Security - authentication, authorization, secret protection, SQL injection, data exposure
alwaysApply: true
globs: ["visary/**/*.py", "**/*.js"]
---

# Security

## Secret Protection

### Mandatory Rules

- NEVER place tokens, keys, passwords, session cookies, credentials, private URLs with token in rules, commits, logs or examples
- When needing command with token, use placeholder/env var (ex: `$SONAR_TOKEN`, `<TOKEN>`)
- If I paste a token in chat, warn and ask me to rotate

### Logs and Exceptions

- DON'T expose secrets/PII in logs, exceptions or responses
- Sanitize logs that contain sensitive data

## Authentication and Authorization

- Auth/authz mandatory in sensitive views
- Validate and sanitize all inputs (GET/POST/data)
- Correct session control (cleanup on logout)
- Cookies with adequate flags (HttpOnly, Secure, SameSite)

## SQL Injection

- NEVER concatenate parameters in SQL
- Use Django ORM or parameterized queries

## Data Exposure

- DON'T expose secrets/PII in logs, exceptions or responses
- **ALWAYS remove debug prints/logs** when identifying (not only in production)
- **NEVER implement logs** - must be manually inserted by operator when necessary
- Sanitize logs that contain sensitive data (only if critical logs manually inserted)

## Best Practices

- Django/Django REST: security, auth, session, cache
- OWASP: Session Management, Broken Authentication, Broken Access Control
- Prioritize simple and robust solutions (don't invent exotic solutions)

## Mandatory Pre-Validation (Context7 + Internet)

Before implementing or changing ANY security-related behavior (auth/authz, sessions, cookies, data exposure, SQL/querying, crypto, headers):

- ALWAYS consult Context7 (MCP) documentation for the involved framework/library to confirm the correct and current secure usage.
- ALWAYS do an internet search to validate current OWASP guidance, known pitfalls, and deprecations for the exact stack/version.

## Validation

- Validate all user inputs
- Sanitize data before queries/displays
- Handle predictable exceptions (DoesNotExist, MultipleObjectsReturned)

## Session and Cache

- Correct session expiration with adequate redirects
- Cache without user data leakage
- localStorage/sessionStorage only for non-sensitive data
