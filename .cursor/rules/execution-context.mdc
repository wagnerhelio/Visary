---
description: Operating context for this repository - Windows, PowerShell, virtual environment, project environments
alwaysApply: true
globs: ["*"]
---

# Execution Context

This project runs on Windows 11. Use PowerShell for commands.

## Virtual Environment

- Venv in `.venv` (activate before executing Python commands)
- Activation: `& .\.venv\Scripts\Activate.ps1`
- NEVER execute commands automatically - only suggest when necessary for validation
- ALWAYS activate venv before executing Python commands: check if activated or suggest activation

## PowerShell Commands - Mandatory Rules

### 1. Command Syntax

- NEVER use `&&` - not valid in PowerShell (bash syntax)
- Use `;` to separate commands on the same line in PowerShell
- Or execute commands separately on different lines

## Mandatory Pre-Validation (Context7 + Internet)

Before proposing or executing any command or change that depends on framework/library/runtime behavior:

- ALWAYS consult Context7 (MCP) documentation for the relevant tools/frameworks/libraries to validate the exact command/flag/behavior.
- ALWAYS do an internet search to validate the most up-to-date usage, deprecations, and Windows/PowerShell specifics.

### 2. Directory Verification

- ALWAYS verify current directory before executing commands that depend on relative paths
- Use `Get-Location` or `pwd` to verify current directory
- ALWAYS navigate to correct directory before executing commands that depend on relative paths
- Use `cd` with absolute or relative path before executing commands

### 3. Command Format

**WRONG (bash syntax):**
```powershell
cd c:\path && Copy-Item file1 file2
```

**CORRECT (PowerShell):**
```powershell
cd c:\path; Copy-Item file1 file2
```

**CORRECT (separated commands):**
```powershell
cd c:\path
Copy-Item file1 file2
```

### 4. Mandatory Process for Commands

Before executing any command that depends on:
- Specific directory
- Activated venv
- Relative paths

ALWAYS do:
1. Verify current directory: `Get-Location` or `pwd`
2. Navigate to correct directory if needed: `cd <path>`
3. Verify/activate venv if Python command: `& .\.venv\Scripts\Activate.ps1`
4. Execute command with correct PowerShell syntax: use `;` instead of `&&`

### 5. File Reorganization

Mandatory Rules for File Movement:
- ALWAYS verify existence before moving/creating
- ALWAYS verify if destination exists before moving
- ALWAYS create directories before moving files
- ALWAYS update imports after movement
- ALWAYS validate after reorganization

### 6. Mandatory Validation After Changes

ALWAYS execute validation after:
- File movement
- Structure reorganization
- Import updates
- Model modifications
- Code refactoring

Validation Commands:
```powershell
# 1. Activate venv
& .\.venv\Scripts\Activate.ps1

# 2. Validate syntax and imports
python visary/manage.py check

# 3. Check migrations (dry-run)
python visary/manage.py makemigrations --dry-run
```

IMPORTANT: If `python visary/manage.py check` generates log outputs (INFO, DEBUG, WARNING), this indicates automatic logs that must be removed. Logs in `__init__` or module level are critical and break PowerShell commands.

## Project Environments

This project has 3 environments:
- Local: SQLite (local development)
- Kubernetes Postgres Homologation: test/staging environment
- Kubernetes Postgres Production: production environment

Consider these differences when suggesting configurations, migrations or commands.

## Common Commands

```powershell
python -m venv .venv
pip install -r requirements.txt
python visary/manage.py makemigrations
python visary/manage.py migrate
python visary/manage.py runserver 0.0.0.0:8000
```

## SonarQube

```powershell
pysonar --sonar-host-url=https://sonarqube.ssp.go.gov.br/ --sonar-token=$SONAR_TOKEN --sonar-project-key=Visary
```

## Cursor Limits

- Reading: ~200-250 lines per call
- IMPORTANT: Even if large files require multiple reading calls, ALWAYS read the complete file (in multiple sequential calls until EOF) before making analyses or corrections
- NEVER make analyses or corrections based on partial reading: read the entire file first, then analyze/correct
- Total context: ~200k tokens (finite)

## Absolute Prohibition of Planning Files

CRITICAL AND MANDATORY RULE:
- NEVER create .md, .plan, .txt or any documentation/planning format files
- NEVER generate reports, analyses or plans in files
- ALWAYS implement directly necessary corrections and improvements
- Planning is mental/internal: if you need to plan, do it mentally and execute immediately

Allowed files (only when necessary for functionality):
- .py (Python code)
- .js (JavaScript code)
- .html (templates)
- .css (styles)
- Other code files necessary for functional implementation

Prohibited files:
- .md (markdown, documentation)
- .plan (plans)
- .txt (text, documentation)
- Any documentation, planning or analysis file

When identifying a problem: correct immediately, don't document the problem in a file.
